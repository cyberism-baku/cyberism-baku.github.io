<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CYBERISM | Pro Arena</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --neon-green: #39ff14; --neon-blue: #00f3ff; --neon-purple: #bc13fe;
            --dark: #05070a; --card: #111827; --square-l: #475569; --square-d: #1e293b;
        }

        body {
            background-color: var(--dark); color: white; font-family: 'Segoe UI', sans-serif;
            margin: 0; display: flex; height: 100vh; overflow: hidden;
        }

        #auth-screen {
            position: fixed; inset: 0; background: var(--dark); z-index: 2000;
            display: flex; align-items: center; justify-content: center;
        }
        .auth-box {
            background: var(--card); padding: 40px; border-radius: 20px;
            border: 2px solid var(--neon-blue); text-align: center; width: 350px;
        }
        input {
            width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px;
            border: 1px solid #334155; background: #000; color: white;
        }

        #side-panel {
            width: 300px; background: #0c111d; border-right: 1px solid var(--neon-purple);
            padding: 20px; display: flex; flex-direction: column;
        }

        #main-stage {
            flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: radial-gradient(circle, #0f172a 0%, #05070a 100%);
        }

        .board {
            display: grid; grid-template-columns: repeat(8, 60px); grid-template-rows: repeat(8, 60px);
            border: 5px solid #1e293b; border-radius: 8px;
        }
        .sq { width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; font-size: 42px; cursor: pointer; user-select: none; }
        .l { background: var(--square-l); } .d { background: var(--square-d); }
        .sel { background: rgba(57, 255, 20, 0.4) !important; }
        .w { color: #fff; filter: drop-shadow(0 0 2px #000); }
        .b { color: #000; filter: drop-shadow(0 0 2px #fff); }

        .btn {
            background: var(--neon-blue); color: #000; padding: 10px 20px;
            border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px;
        }
        .user-row { display: flex; justify-content: space-between; padding: 8px; background: #1a2233; margin-bottom: 5px; border-radius: 5px; font-size: 13px;}
        
        #admin-modal { display: none; position: fixed; inset: 10%; background: var(--card); border: 2px solid red; z-index: 3000; padding: 20px; overflow-y: auto; }
        #admin-trigger { position: fixed; bottom: 5px; right: 5px; opacity: 0.1; cursor: pointer; font-size: 10px;}
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-box">
            <h1 style="color: var(--neon-blue);">CYBERISM</h1>
            <input type="text" id="user-in" placeholder="ƒ∞stifad…ô√ßi Adƒ±">
            <input type="password" id="pass-in" placeholder="≈ûifr…ô">
            <button class="btn" style="width: 100%;" onclick="startApp()">Gƒ∞Rƒ∞≈û</button>
        </div>
    </div>

    <div id="admin-modal">
        <h2 style="color: red;">ADMIN CONTROL</h2>
        <div id="admin-list"></div>
        <button class="btn" onclick="document.getElementById('admin-modal').style.display='none'">Baƒüla</button>
    </div>

    <div id="side-panel">
        <h2 style="color: var(--neon-purple); font-size: 18px;">üë• DOSTLAR</h2>
        <button class="btn" style="font-size: 11px; background: var(--neon-purple); color: white;" onclick="addFriend()">+ DOST ∆èLAV∆è ET</button>
        <div id="friends-list" style="flex: 1; margin-top: 10px;"></div>
        
        <hr style="border: 0.5px solid #1f2937;">
        
        <h2 style="color: #fbbf24; font-size: 18px;">üèÜ TOP 10</h2>
        <div id="leaderboard" style="flex: 1; overflow-y: auto;"></div>
    </div>

    <div id="main-stage">
        <div id="status" style="margin-bottom: 10px; color: var(--neon-blue);">CYBERISM ARENA</div>
        <div id="chess-board" class="board"></div>
        <div style="margin-top: 15px; text-align: center;">
            <div id="display-name" style="font-size: 18px; font-weight: bold;"></div>
            <div style="color: var(--neon-green); font-size: 22px;">PUAN: <span id="display-puan">0</span></div>
            <div id="display-id" style="font-size: 12px; color: gray;"></div>
            <button class="btn" onclick="matchmake()">MATCH (1v1)</button>
        </div>
    </div>

    <div id="admin-trigger" onclick="adminGate()">ismayilovismayil</div>

    <script>
        // S∆èNƒ∞N Fƒ∞REBASE M∆èLUMATLARIN
        const firebaseConfig = {
            databaseURL: "https://cyberism-7104c-default-rtdb.firebaseio.com",
            projectId: "cyberism-7104c",
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const game = new Chess();
        const boardEl = document.getElementById('chess-board');
        let myData = { username: "", id: "", puan: 0 };
        let selectedSq = null;
        let adminSteps = 0;

        // S…ôs effektl…ôri
        const moveSnd = new Audio('https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3');
        const checkSnd = new Audio('https://assets.mixkit.co/active_storage/sfx/133/133-preview.mp3');

        function startApp() {
            const u = document.getElementById('user-in').value;
            if(u.length < 3) return alert("Adƒ± daxil edin!");
            
            myData.username = u;
            myData.id = "ism" + Math.floor(10000 + Math.random() * 90000);
            
            db.ref('users/' + myData.id).set(myData);
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('display-name').innerText = u;
            document.getElementById('display-id').innerText = "ID: " + myData.id;
            
            drawBoard();
            liveSync();
        }

        function drawBoard() {
            boardEl.innerHTML = '';
            const b = game.board();
            const pMap = { 'p': '‚ôü', 'r': '‚ôú', 'n': '‚ôû', 'b': '‚ôù', 'q': '‚ôõ', 'k': '‚ôö', 'P': '‚ôô', 'R': '‚ôñ', 'N': '‚ôò', 'B': '‚ôó', 'Q': '‚ôï', 'K': '‚ôî' };
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                    const s = document.createElement('div');
                    s.className = `sq ${(i + j) % 2 === 0 ? 'l' : 'd'}`;
                    s.dataset.pos = String.fromCharCode(97 + j) + (8 - i);
                    const p = b[i][j];
                    if (p) {
                        s.textContent = pMap[p.color === 'w' ? p.type.toUpperCase() : p.type.toLowerCase()];
                        s.classList.add(p.color === 'w' ? 'w' : 'b');
                    }
                    s.onclick = () => handleMove(s.dataset.pos);
                    boardEl.appendChild(s);
                }
            }
        }

        function handleMove(pos) {
            if (selectedSq === pos) { selectedSq = null; drawBoard(); return; }
            if (selectedSq) {
                const move = game.move({ from: selectedSq, to: pos, promotion: 'q' });
                if (move) {
                    moveSnd.play();
                    selectedSq = null;
                    drawBoard();
                    checkGameOver();
                    setTimeout(botMove, 1000);
                } else { selectedSq = pos; drawBoard(); highlight(pos); }
            } else { selectedSq = pos; highlight(pos); }
        }

        function botMove() {
            const moves = game.moves();
            if (moves.length > 0) {
                game.move(moves[Math.floor(Math.random() * moves.length)]);
                moveSnd.play();
                drawBoard();
                checkGameOver();
            }
        }

        function checkGameOver() {
            if (game.in_checkmate()) {
                checkSnd.play();
                const winner = game.turn() === 'b' ? 'Aƒü' : 'Qara';
                alert("MAT! Qalib: " + winner);
                if(winner === 'Aƒü') updateScore(100); else updateScore(-50);
                game.reset();
                drawBoard();
            } else if (game.in_draw()) {
                alert("B…ôrab…ôr…ô!");
                game.reset();
                drawBoard();
            }
        }

        function updateScore(points) {
            myData.puan += points;
            if(myData.puan < 0) myData.puan = 0;
            document.getElementById('display-puan').innerText = myData.puan;
            db.ref('users/' + myData.id).update({ puan: myData.puan });
        }

        function addFriend() {
            const fId = prompt("Dostunun ID-sini yaz (m…ôs: ism12345):");
            if(fId) {
                db.ref('users/' + fId).once('value', s => {
                    if(s.exists()) {
                        const f = s.val();
                        const div = document.createElement('div');
                        div.className = "user-row";
                        div.innerHTML = `<span>üü¢ ${f.username}</span> <button class="btn" style="padding:2px 5px; margin:0;" onclick="alert('D…ôv…ôt getdi')">VS</button>`;
                        document.getElementById('friends-list').appendChild(div);
                    } else { alert("ƒ∞stifad…ô√ßi tapƒ±lmadƒ±!"); }
                });
            }
        }

        function liveSync() {
            db.ref('users').orderByChild('puan').limitToLast(10).on('value', snap => {
                const lb = document.getElementById('leaderboard');
                lb.innerHTML = '';
                let ranks = [];
                snap.forEach(child => ranks.push(child.val()));
                ranks.reverse().forEach((u, index) => {
                    lb.innerHTML += `<div class="user-row"><span>${index+1}. ${u.username}</span><b>${u.puan}</b></div>`;
                });
            });

            db.ref('users').on('value', snap => {
                const al = document.getElementById('admin-list');
                al.innerHTML = '';
                snap.forEach(child => {
                    const u = child.val();
                    al.innerHTML += `<div class="user-row">${u.username} (${u.id}) <button onclick="ban('${u.id}')">BAN</button></div>`;
                });
            });
        }

        function highlight(pos) { document.querySelectorAll('.sq').forEach(s => { if(s.dataset.pos === pos) s.classList.add('sel'); }); }
        function matchmake() { 
            document.getElementById('status').innerText = "Axtarƒ±lƒ±r..."; 
            setTimeout(() => document.getElementById('status').innerText = "R…ôqib qo≈üuldu!", 2000);
        }
        function ban(id) { if(confirm("Silinsin?")) db.ref('users/' + id).remove(); }
        function adminGate() {
            adminSteps++;
            if(adminSteps === 5) {
                const p = prompt("PASSWORD:");
                if(p === "qaqa0202@") document.getElementById('admin-modal').style.display = 'block';
                adminSteps = 0;
            }
        }
    </script>
</body>
</html>
