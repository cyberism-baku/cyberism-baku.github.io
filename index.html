<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CYBERISM | Pro Arena</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --neon-green: #39ff14; --neon-blue: #00f3ff; --neon-purple: #bc13fe;
            --dark: #05070a; --card: #111827; --sq-l: #475569; --sq-d: #1e293b;
        }

        body { background-color: var(--dark); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
        
        /* UI Kit */
        .btn { background: var(--neon-blue); color: #000; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; margin: 5px 0; font-size: 14px; }
        input, textarea { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #334155; background: #000; color: white; font-size: 16px; box-sizing: border-box; }
        
        header { padding: 10px 15px; background: #0c111d; border-bottom: 1px solid var(--neon-purple); display: flex; justify-content: space-between; align-items: center; z-index: 100; }
        .tab-content { display: none; flex: 1; padding: 15px; overflow-y: auto; padding-bottom: 90px; }

        /* Profil Kartƒ± */
        .profile-card { background: var(--card); border: 1px solid var(--neon-blue); border-radius: 15px; padding: 20px; text-align: center; margin-bottom: 15px; }
        .stat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; }
        .stat-box { background: #05070a; padding: 10px; border-radius: 8px; border: 1px solid #1e293b; }
        .stat-box small { color: gray; display: block; font-size: 10px; text-transform: uppercase; }
        .stat-box b { color: var(--neon-green); font-size: 16px; }

        /* Liqa Ni≈üanlarƒ± */
        .league-badge { padding: 3px 10px; border-radius: 10px; font-size: 11px; font-weight: bold; }
        .l-bronze { background: #613916; color: #fff; }
        .l-silver { background: #95a5a6; color: #000; }
        .l-gold { background: #f1c40f; color: #000; box-shadow: 0 0 10px #f1c40f; }
        .l-diamond { background: #3498db; color: #fff; box-shadow: 0 0 15px var(--neon-blue); }

        /* Arena Mode */
        #arena-mode { display: none; position: fixed; inset: 0; background: var(--dark); z-index: 5000; flex-direction: column; }
        .board { display: grid; grid-template-columns: repeat(8, 12vw); grid-template-rows: repeat(8, 12vw); margin: auto; border: 3px solid #1e293b; }
        @media (min-width: 800px) { .board { grid-template-columns: repeat(8, 55px); grid-template-rows: repeat(8, 55px); } }
        .sq { display: flex; align-items: center; justify-content: center; font-size: 8vw; cursor: pointer; }
        @media (min-width: 800px) { .sq { font-size: 38px; } }
        .l { background: var(--sq-l); } .d { background: var(--sq-d); }

        /* Chat */
        .chat-box { background: #000; border-radius: 10px; height: 150px; overflow-y: auto; padding: 10px; border: 1px solid #1e293b; margin-bottom: 10px; }
        .msg { font-size: 13px; margin-bottom: 4px; }
        .msg b { color: var(--neon-blue); }

        /* Bottom Nav */
        nav { position: fixed; bottom: 0; width: 100%; height: 75px; background: #0c111d; border-top: 1px solid var(--neon-blue); display: flex; justify-content: space-around; align-items: center; z-index: 1000; }
        .nav-btn { background: none; border: none; color: gray; font-size: 10px; text-align: center; cursor: pointer; }
        .nav-btn.active { color: var(--neon-blue); font-weight: bold; }
    </style>
</head>
<body>

    <div onclick="checkAdmin()" style="position:fixed; top:0; right:0; width:60px; height:60px; z-index:10001;"></div>

    <div id="auth-screen" style="position:fixed; inset:0; background:var(--dark); z-index:10000; display:flex; align-items:center; justify-content:center;">
        <div style="width: 85%; max-width: 360px; background: var(--card); padding: 30px; border-radius: 20px; border: 2px solid var(--neon-blue); text-align:center;">
            <h1 style="color:var(--neon-blue); margin:0 0 20px 0;">CYBERISM</h1>
            <input type="text" id="user-in" placeholder="Username v…ô ya ID">
            <input type="password" id="pass-in" placeholder="≈ûifr…ô">
            <button class="btn" onclick="login()">DAXƒ∞L OL</button>
            <button class="btn" style="background:var(--neon-purple); color:white;" onclick="register()">QEYDƒ∞YYAT</button>
        </div>
    </div>

    <header>
        <div><span id="h-league" class="league-badge l-bronze">B√ºr√ºnc</span> <b id="h-name">...</b></div>
        <div style="color:var(--neon-green)">üèÜ <span id="h-puan">0</span></div>
    </header>

    <div style="flex:1; overflow:hidden; position:relative;">
        
        <div id="game-tab" class="tab-content" style="display:flex; flex-direction:column; align-items:center; justify-content:center;">
            <div id="search-status" style="display:none; color:var(--neon-blue); margin-bottom:10px;">R…ôqib axtarƒ±lƒ±r...</div>
            <button class="btn" style="height:100px; font-size:20px; width:80%;" id="play-btn" onclick="startMatch()">MATCH START</button>
        </div>

        <div id="profile-tab" class="tab-content">
            <div class="profile-card">
                <div id="p-league-tag" class="league-badge l-bronze">B√úR√úNC</div>
                <h2 id="p-name" style="margin:10px 0 5px 0;">...</h2>
                <small id="p-id" style="color:var(--neon-blue); font-family:monospace;">ID: ism0000</small>
                <p id="p-bio" style="font-size:14px; color:#94a3b8; font-style:italic;">Bio y√ºkl…ônir...</p>
                
                <div class="stat-grid">
                    <div class="stat-box"><small>MAC</small><b id="s-total">0</b></div>
                    <div class="stat-box"><small>UDU≈û</small><b id="s-win">0</b></div>
                    <div class="stat-box"><small>UDUZU≈û</small><b id="s-lose" style="color:red">0</b></div>
                </div>
            </div>

            <div style="background:var(--card); padding:15px; border-radius:15px; border:1px solid #1e293b;">
                <label style="font-size:12px; color:gray;">Bioqrafiyanƒ± Redakt…ô Et:</label>
                <textarea id="bio-in" rows="2" placeholder="√ñz√ºn haqqƒ±nda yaz..."></textarea>
                <button class="btn" onclick="updateBio()">YADDA SAXLA</button>
            </div>
        </div>

        <div id="leader-tab" class="tab-content">
            <h3 style="text-align:center; color:#fbbf24;">GLOBAL SIRALAMA</h3>
            <div id="leader-list"></div>
        </div>

        <div id="friends-tab" class="tab-content">
            <h3>Dostlarƒ±m</h3>
            <div style="display:flex; gap:5px;">
                <input type="text" id="fid-in" placeholder="Dost ID yaz...">
                <button class="btn" style="width:100px;" onclick="addFriend()">Dost Ol</button>
            </div>
            <div id="f-requests" style="margin-top:10px; color:var(--neon-green)"></div>
            <hr style="border:0; border-top:1px solid #1e293b; margin:15px 0;">
            <div id="f-list"></div>
        </div>

        <div id="chat-tab" class="tab-content">
            <h3>Global Chat</h3>
            <div id="global-chat" class="chat-box" style="height:60vh;"></div>
            <div style="display:flex; gap:5px;">
                <input type="text" id="gmsg-in" placeholder="Mesaj yaz...">
                <button class="btn" style="width:70px;" onclick="sendGlobal()">OK</button>
            </div>
        </div>
    </div>

    <div id="arena-mode">
        <div style="padding:12px; background:#0c111d; display:flex; justify-content:space-between; align-items:center;">
            <span>R…ôqib: <b id="opp-name">BOT</b></span>
            <button onclick="leaveGame()" style="background:red; color:white; border:none; padding:6px 12px; border-radius:5px;">√áIX</button>
        </div>
        <div id="chess-board" class="board"></div>
        <div style="flex:1; padding:10px; display:flex; flex-direction:column;">
            <div id="arena-chat" class="chat-box" style="flex:1;"></div>
            <div style="display:flex; gap:5px;">
                <input type="text" id="amsg-in" placeholder="R…ôqib…ô yaz..." style="margin:0;">
                <button class="btn" style="width:60px; margin:0;" onclick="sendArenaMsg()">OK</button>
            </div>
        </div>
    </div>

    <nav>
        <div class="nav-btn active" onclick="tab('game', this)"><i>üéÆ</i><br>ARENA</div>
        <div class="nav-btn" onclick="tab('profile', this)"><i>üë§</i><br>PROFƒ∞L</div>
        <div class="nav-btn" onclick="tab('friends', this)"><i>üë•</i><br>DOSTLAR</div>
        <div class="nav-btn" onclick="tab('leader', this)"><i>üèÜ</i><br>TOP</div>
        <div class="nav-btn" onclick="tab('chat', this)"><i>üí¨</i><br>CHAT</div>
    </nav>

    <script>
        const firebaseConfig = { databaseURL: "https://cyberism-7104c-default-rtdb.firebaseio.com" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const game = new Chess();
        let myData = null;
        let adminClicks = 0;
        let selectedSq = null;

        // AUTH
        function register() {
            const u = document.getElementById('user-in').value;
            const p = document.getElementById('pass-in').value;
            if(u.length < 3) return alert("Ad qƒ±sadƒ±r!");
            const id = "ism" + Math.floor(1000 + Math.random() * 9000);
            const user = { username: u, password: p, id: id, puan: 0, bio: "Salam, m…ôn yeniy…ôm!", win: 0, lose: 0, total: 0 };
            db.ref('users/' + id).set(user).then(() => {
                alert("Uƒüurlu! ID: " + id);
                loginSuccess(user);
            });
        }

        function login() {
            const id = document.getElementById('user-in').value;
            const p = document.getElementById('pass-in').value;
            db.ref('users/' + id).once('value', s => {
                if(s.exists() && s.val().password === p) loginSuccess(s.val());
                else alert("X…ôtalƒ± giri≈ü!");
            });
        }

        function loginSuccess(u) {
            myData = u;
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('h-name').innerText = u.username;
            refreshUI();
            initRealtime();
        }

        // LEAGUE & UI
        function getLeague(p) {
            if(p < 100) return {n: "B√ºr√ºnc", c: "l-bronze"};
            if(p < 500) return {n: "G√ºm√º≈ü", c: "l-silver"};
            if(p < 1500) return {n: "Qƒ±zƒ±l", c: "l-gold"};
            return {n: "Diamond", c: "l-diamond"};
        }

        function refreshUI() {
            const l = getLeague(myData.puan);
            document.getElementById('h-league').innerText = l.n;
            document.getElementById('h-league').className = "league-badge " + l.c;
            document.getElementById('h-puan').innerText = myData.puan;
            
            // Profil
            document.getElementById('p-name').innerText = myData.username;
            document.getElementById('p-id').innerText = "ID: " + myData.id;
            document.getElementById('p-bio').innerText = myData.bio;
            document.getElementById('p-league-tag').innerText = l.n.toUpperCase();
            document.getElementById('p-league-tag').className = "league-badge " + l.c;
            document.getElementById('s-total').innerText = myData.total;
            document.getElementById('s-win').innerText = myData.win;
            document.getElementById('s-lose').innerText = myData.lose;
        }

        function updateBio() {
            const b = document.getElementById('bio-in').value;
            if(!b) return;
            db.ref('users/' + myData.id).update({ bio: b });
            myData.bio = b;
            refreshUI();
            alert("Bio yenil…ôndi!");
        }

        // GAME LOGIC
        function startMatch() {
            document.getElementById('play-btn').style.display = 'none';
            document.getElementById('search-status').style.display = 'block';
            setTimeout(() => {
                document.getElementById('arena-mode').style.display = 'flex';
                document.getElementById('opp-name').innerText = "CYBER_BOT_" + Math.floor(Math.random()*99);
                game.reset();
                draw();
            }, 2000);
        }

        function draw() {
            const bEl = document.getElementById('chess-board');
            bEl.innerHTML = '';
            const board = game.board();
            const pMap = { 'p': '‚ôü', 'r': '‚ôú', 'n': '‚ôû', 'b': '‚ôù', 'q': '‚ôõ', 'k': '‚ôö', 'P': '‚ôô', 'R': '‚ôñ', 'N': '‚ôò', 'B': '‚ôó', 'Q': '‚ôï', 'K': '‚ôî' };
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                    const s = document.createElement('div');
                    s.className = `sq ${(i + j) % 2 === 0 ? 'l' : 'd'}`;
                    const p = board[i][j];
                    if (p) {
                        s.textContent = pMap[p.color === 'w' ? p.type.toUpperCase() : p.type.toLowerCase()];
                        s.style.color = p.color === 'w' ? 'white' : 'black';
                    }
                    s.onclick = () => move(String.fromCharCode(97 + j) + (8 - i));
                    bEl.appendChild(s);
                }
            }
        }

        function move(pos) {
            const m = game.move({ from: selectedSq, to: pos, promotion: 'q' });
            if (m) {
                draw();
                if(game.in_checkmate()) end(true);
                else setTimeout(botMove, 600);
            }
            selectedSq = pos;
        }

        function botMove() {
            const ms = game.moves();
            if(ms.length > 0) {
                game.move(ms[Math.floor(Math.random()*ms.length)]);
                draw();
                if(game.in_checkmate()) end(false);
            }
        }

        function end(win) {
            alert(win ? "TEBRƒ∞KLER! +40 Puan" : "UDUZDUNUZ! -15 Puan");
            const up = {
                puan: win ? myData.puan + 40 : Math.max(0, myData.puan - 15),
                win: win ? myData.win + 1 : myData.win,
                lose: !win ? myData.lose + 1 : myData.lose,
                total: myData.total + 1
            };
            db.ref('users/' + myData.id).update(up);
            Object.assign(myData, up);
            leaveGame();
        }

        function leaveGame() {
            document.getElementById('arena-mode').style.display = 'none';
            document.getElementById('play-btn').style.display = 'block';
            document.getElementById('search-status').style.display = 'none';
            refreshUI();
        }

        // REALTIME & CHATS
        function initRealtime() {
            // Global Chat
            db.ref('global_chat').limitToLast(25).on('value', s => {
                const b = document.getElementById('global-chat');
                b.innerHTML = '';
                s.forEach(c => {
                    b.innerHTML += `<div class="msg"><b>${c.val().u}:</b> ${c.val().m}</div>`;
                });
                b.scrollTop = b.scrollHeight;
            });

            // Leaderboard
            db.ref('users').orderByChild('puan').limitToLast(10).on('value', s => {
                const l = document.getElementById('leader-list');
                l.innerHTML = '';
                let a = []; s.forEach(c => a.push(c.val()));
                a.reverse().forEach((u, i) => {
                    const lg = getLeague(u.puan);
                    l.innerHTML += `<div style="background:var(--card); padding:12px; margin:6px 0; border-radius:10px; display:flex; justify-content:space-between; align-items:center; border:1px solid #1e293b;">
                        <span>${i+1}. ${u.username} <small class="league-badge ${lg.c}">${lg.n}</small></span>
                        <b>${u.puan}</b>
                    </div>`;
                });
            });

            // Requests
            db.ref('requests/' + myData.id).on('value', s => {
                const div = document.getElementById('f-requests');
                div.innerHTML = '';
                s.forEach(r => {
                    div.innerHTML += `<div>Sorƒüu: ${r.val().fromName} <button onclick="acceptF('${r.key}','${r.val().fromName}')">Q…ôbul</button></div>`;
                });
            });
        }

        function sendGlobal() {
            const m = document.getElementById('gmsg-in').value;
            if(!m) return;
            db.ref('global_chat').push({ u: myData.username, m: m });
            document.getElementById('gmsg-in').value = '';
        }

        function sendArenaMsg() {
            const m = document.getElementById('amsg-in').value;
            if(!m) return;
            const b = document.getElementById('arena-chat');
            b.innerHTML += `<div class="msg"><b>S…ôn:</b> ${m}</div>`;
            document.getElementById('amsg-in').value = '';
            b.scrollTop = b.scrollHeight;
        }

        function addFriend() {
            const fid = document.getElementById('fid-in').value;
            if(!fid || fid === myData.id) return;
            db.ref('requests/' + fid + '/' + myData.id).set({ fromName: myData.username });
            alert("Sorƒüu g√∂nd…ôrildi!");
        }

        function acceptF(id, name) {
            db.ref('users/'+myData.id+'/friends/'+id).set(name);
            db.ref('users/'+id+'/friends/'+myData.id).set(myData.username);
            db.ref('requests/'+myData.id+'/'+id).remove();
            alert("Artƒ±q dostsunuz!");
        }

        // TABS
        function tab(t, el) {
            document.querySelectorAll('.tab-content').forEach(x => x.style.display = 'none');
            document.getElementById(t + '-tab').style.display = (t==='game'?'flex':'block');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }

        function checkAdmin() {
            adminClicks++;
            if(adminClicks >= 5) {
                const p = prompt("Admin ≈ûifr…ô:");
                if(p === "qaqa0202@") {
                    alert("Admin paneli tezlikl…ô …ôlav…ô olunacaq.");
                }
                adminClicks = 0;
            }
        }
    </script>
</body>
</html>
