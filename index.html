<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CYBERISM | Ultimate Arena</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --neon-green: #39ff14; --neon-blue: #00f3ff; --neon-purple: #bc13fe;
            --dark: #05070a; --card: #111827; --sq-l: #475569; --sq-d: #1e293b;
        }

        body { 
            background-color: var(--dark); color: white; font-family: 'Segoe UI', sans-serif; 
            margin: 0; padding: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column;
        }

        /* UI Elementl…ôri */
        .auth-box, .modal-box { background: var(--card); padding: 25px; border-radius: 15px; border: 2px solid var(--neon-blue); text-align: center; width: 90%; max-width: 350px; }
        input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #334155; background: #000; color: white; font-size: 16px; }
        .btn { background: var(--neon-blue); color: #000; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; margin: 5px 0; }

        header { padding: 10px 15px; background: #0c111d; border-bottom: 1px solid var(--neon-purple); display: flex; justify-content: space-between; align-items: center; font-size: 14px; }
        .tab-content { display: none; flex: 1; padding: 15px; overflow-y: auto; padding-bottom: 80px; }

        /* Dostlar S…ôhif…ôsi */
        .friends-page { display: none; position: fixed; inset: 0; background: var(--dark); z-index: 2000; padding: 20px; flex-direction: column; }

        /* Arena Mode */
        #arena-mode { display: none; position: fixed; inset: 0; background: var(--dark); z-index: 3000; flex-direction: column; }
        .board { display: grid; grid-template-columns: repeat(8, 12vw); grid-template-rows: repeat(8, 12vw); margin: auto; border: 3px solid #1e293b; }
        @media (min-width: 800px) { .board { grid-template-columns: repeat(8, 50px); grid-template-rows: repeat(8, 50px); } }
        .sq { display: flex; align-items: center; justify-content: center; font-size: 8vw; }
        @media (min-width: 800px) { .sq { font-size: 35px; } }
        .l { background: var(--sq-l); } .d { background: var(--sq-d); }

        /* √áat Sisteml…ôri */
        .chat-container { background: #000; border-radius: 10px; height: 200px; overflow-y: auto; padding: 10px; margin-bottom: 10px; border: 1px solid #1e293b; }
        .msg { margin-bottom: 5px; font-size: 13px; }
        .msg b { color: var(--neon-blue); }

        /* Navbar */
        nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: #0c111d; border-top: 1px solid var(--neon-blue); display: flex; justify-content: space-around; align-items: center; z-index: 1000; }
        .nav-btn { background: none; border: none; color: gray; font-size: 11px; text-align: center; }
        .nav-btn.active { color: var(--neon-blue); }

        /* Rutb…ô R…ôngl…ôri */
        .rank-gold { color: gold; font-weight: bold; }
        .rank-diamond { color: #b9f2ff; text-shadow: 0 0 5px #00f3ff; }
        
        #admin-panel { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 9999; padding: 20px; }
    </style>
</head>
<body>

    <div onclick="checkAdmin()" style="position:fixed; top:0; right:0; width:50px; height:50px; z-index:10001;"></div>

    <div id="auth-screen" style="position:fixed; inset:0; background:var(--dark); z-index:10000; display:flex; align-items:center; justify-content:center;">
        <div class="auth-box">
            <h2 style="color:var(--neon-blue);">CYBERISM</h2>
            <input type="text" id="user-in" placeholder="Ad v…ô ya ID">
            <input type="password" id="pass-in" placeholder="≈ûifr…ô">
            <button class="btn" onclick="login()">DAXƒ∞L OL</button>
            <button class="btn" style="background:var(--neon-purple); color:#fff;" onclick="register()">QEYDƒ∞YYAT</button>
        </div>
    </div>

    <header>
        <div><span id="u-rank">Rank</span> | <b id="u-name">...</b></div>
        <div style="color:var(--neon-green)">üèÜ <span id="u-puan">0</span></div>
    </header>

    <div class="container">
        <div id="game-tab" class="tab-content" style="display:flex; flex-direction:column; align-items:center; justify-content:center;">
            <button class="btn" style="height:80px; font-size:20px;" id="start-btn" onclick="matchmake()">MATCH START</button>
        </div>

        <div id="leader-tab" class="tab-content">
            <h3 style="color:#fbbf24; text-align:center;">GLOBAL SIRALAMA</h3>
            <div id="leaderboard-list"></div>
        </div>

        <div id="chat-tab" class="tab-content">
            <h3>GLOBAL CHAT</h3>
            <div id="global-chat-box" class="chat-container" style="height:60vh;"></div>
            <div style="display:flex; gap:5px;">
                <input type="text" id="global-msg" placeholder="Hamƒ±ya yaz...">
                <button class="btn" style="width:70px;" onclick="sendGlobalChat()">OK</button>
            </div>
        </div>
    </div>

    <div id="friends-page" class="friends-page">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2>Dostlarƒ±m</h2>
            <button class="btn" style="width:60px;" onclick="toggleFriends()">X</button>
        </div>
        <div style="display:flex; gap:5px;">
            <input type="text" id="friend-id-in" placeholder="ID yaz: ism1234">
            <button class="btn" style="width:100px;" onclick="sendFriendRequest()">Dost Ol</button>
        </div>
        <div id="friend-requests" style="margin-top:10px; color:var(--neon-green)"></div>
        <hr style="width:100%; border:0.5px solid #334155;">
        <div id="my-friends-list"></div>
    </div>

    <div id="arena-mode">
        <div style="padding:10px; display:flex; justify-content:space-between; background:#0c111d;">
            <span>R…ôqib: <b id="opp-name">Axtarƒ±lƒ±r...</b></span>
            <button onclick="exitGame()" style="background:red; border:none; color:white; border-radius:5px; padding:5px 10px;">√áIX</button>
        </div>
        <div id="chess-board" class="board"></div>
        <div style="flex:1; display:flex; flex-direction:column; padding:10px;">
            <div id="arena-chat-box" class="chat-container"></div>
            <div style="display:flex; gap:5px;">
                <input type="text" id="arena-msg" placeholder="R…ôqib…ô yaz...">
                <button class="btn" style="width:60px;" onclick="sendArenaChat()">G√ñND∆èR</button>
            </div>
        </div>
    </div>

    <div id="admin-panel">
        <h2 style="color:red;">ADMIN PANEL</h2>
        <div id="admin-users" style="height:70vh; overflow-y:auto;"></div>
        <button class="btn" onclick="document.getElementById('admin-panel').style.display='none'">BAƒûLA</button>
    </div>

    <nav id="navbar">
        <div class="nav-btn active" onclick="switchTab('game', this)"><i>üéÆ</i><br>ARENA</div>
        <div class="nav-btn" onclick="toggleFriends()"><i>üë•</i><br>DOSTLAR</div>
        <div class="nav-btn" onclick="switchTab('leader', this)"><i>üèÜ</i><br>TOP 10</div>
        <div class="nav-btn" onclick="switchTab('chat', this)"><i>üí¨</i><br>CHAT</div>
    </nav>

    <script>
        const firebaseConfig = { databaseURL: "https://cyberism-7104c-default-rtdb.firebaseio.com" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const game = new Chess();
        let myData = null;
        let adminClicks = 0;

        // AUTH & LOGƒ∞N
        function register() {
            const u = document.getElementById('user-in').value;
            const p = document.getElementById('pass-in').value;
            if(u.length < 3) return alert("Ad √ßox qƒ±sadƒ±r!");
            const id = "ism" + Math.floor(1000 + Math.random() * 9000);
            const userObj = { username: u, password: p, id: id, puan: 0, status: "online", friends: [] };
            db.ref('users/' + id).set(userObj).then(() => {
                alert("ID-niz: " + id);
                loginSuccess(userObj);
            });
        }

        function login() {
            const id = document.getElementById('user-in').value;
            const p = document.getElementById('pass-in').value;
            db.ref('users/' + id).once('value', s => {
                const u = s.val();
                if(u && u.password === p) loginSuccess(u);
                else alert("X…ôtalƒ± m…ôlumat!");
            });
        }

        function loginSuccess(u) {
            myData = u;
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('u-name').innerText = u.username;
            updateUI();
            initRealtime();
        }

        // RANK Sƒ∞STEMƒ∞
        function getRank(p) {
            if(p < 100) return {n: "B√ºr√ºnc", c: "gray"};
            if(p < 500) return {n: "G√ºm√º≈ü", c: "silver"};
            if(p < 1000) return {n: "Qƒ±zƒ±l", c: "rank-gold"};
            return {n: "Efsanevi", c: "rank-diamond"};
        }

        function updateUI() {
            const r = getRank(myData.puan);
            document.getElementById('u-rank').innerText = r.n;
            document.getElementById('u-rank').className = r.c;
            document.getElementById('u-puan').innerText = myData.puan;
        }

        // DOSTLUQ Sƒ∞STEMƒ∞
        function toggleFriends() {
            const p = document.getElementById('friends-page');
            p.style.display = (p.style.display === 'flex' ? 'none' : 'flex');
        }

        function sendFriendRequest() {
            const fid = document.getElementById('friend-id-in').value;
            if(!fid || fid === myData.id) return;
            db.ref('requests/' + fid + '/' + myData.id).set({ fromName: myData.username });
            alert("Dostluq sorƒüusu g√∂nd…ôrildi!");
        }

        // MATCHMAKING & GAME
        function matchmake() {
            document.getElementById('start-btn').innerText = "AXTARILIR...";
            setTimeout(() => {
                document.getElementById('arena-mode').style.display = 'flex';
                document.getElementById('opp-name').innerText = "Bot_Grandmaster";
                game.reset();
                drawBoard();
            }, 2000);
        }

        function drawBoard() {
            const bEl = document.getElementById('chess-board');
            bEl.innerHTML = '';
            const b = game.board();
            const pMap = { 'p': '‚ôü', 'r': '‚ôú', 'n': '‚ôû', 'b': '‚ôù', 'q': '‚ôõ', 'k': '‚ôö', 'P': '‚ôô', 'R': '‚ôñ', 'N': '‚ôò', 'B': '‚ôó', 'Q': '‚ôï', 'K': '‚ôî' };
            
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                    const s = document.createElement('div');
                    s.className = `sq ${(i + j) % 2 === 0 ? 'l' : 'd'}`;
                    const p = b[i][j];
                    if (p) {
                        s.textContent = pMap[p.color === 'w' ? p.type.toUpperCase() : p.type.toLowerCase()];
                        s.style.color = p.color === 'w' ? 'white' : 'black';
                    }
                    s.onclick = () => handleMove(String.fromCharCode(97 + j) + (8 - i));
                    bEl.appendChild(s);
                }
            }
        }

        function handleMove(pos) {
            const moves = game.move({ from: selectedSq, to: pos, promotion: 'q' });
            if (moves) {
                drawBoard();
                setTimeout(() => {
                    const m = game.moves();
                    if(m.length > 0) game.move(m[Math.floor(Math.random()*m.length)]);
                    drawBoard();
                }, 500);
            }
            selectedSq = pos;
        }

        // CHAT Sƒ∞STEML∆èRƒ∞
        function sendGlobalChat() {
            const m = document.getElementById('global-msg').value;
            if(!m) return;
            db.ref('global_chat').push({ u: myData.username, m: m });
            document.getElementById('global-msg').value = '';
        }

        function sendArenaChat() {
            const m = document.getElementById('arena-msg').value;
            const box = document.getElementById('arena-chat-box');
            box.innerHTML += `<div class="msg"><b>S…ôn:</b> ${m}</div>`;
            document.getElementById('arena-msg').value = '';
            box.scrollTop = box.scrollHeight;
        }

        // REALTIME UPDATES
        function initRealtime() {
            // Global Chat
            db.ref('global_chat').limitToLast(20).on('value', s => {
                const box = document.getElementById('global-chat-box');
                box.innerHTML = '';
                s.forEach(c => {
                    box.innerHTML += `<div class="msg"><b>${c.val().u}:</b> ${c.val().m}</div>`;
                });
                box.scrollTop = box.scrollHeight;
            });

            // Liderlik
            db.ref('users').orderByChild('puan').limitToLast(10).on('value', s => {
                const list = document.getElementById('leaderboard-list');
                list.innerHTML = '';
                let arr = []; s.forEach(c => arr.push(c.val()));
                arr.reverse().forEach((u, i) => {
                    const r = getRank(u.puan);
                    list.innerHTML += `<div style="padding:10px; background:#1a2233; margin:5px; border-radius:10px; display:flex; justify-content:space-between;">
                        <span>${i+1}. ${u.username} <small class="${r.c}">(${r.n})</small></span>
                        <b>${u.puan}</b>
                    </div>`;
                });
            });

            // Dostluq Sorƒüularƒ±
            db.ref('requests/' + myData.id).on('value', s => {
                const div = document.getElementById('friend-requests');
                div.innerHTML = '';
                s.forEach(r => {
                    div.innerHTML += `Sorƒüu: ${r.val().fromName} <button onclick="acceptFriend('${r.key}','${r.val().fromName}')">Q…ôbul</button>`;
                });
            });
        }

        function acceptFriend(id, name) {
            db.ref('users/' + myData.id + '/friends/' + id).set(name);
            db.ref('users/' + id + '/friends/' + myData.id).set(myData.username);
            db.ref('requests/' + myData.id + '/' + id).remove();
            alert("Artƒ±q dostsunuz!");
        }

        function switchTab(t, el) {
            document.querySelectorAll('.tab-content').forEach(x => x.style.display = 'none');
            document.getElementById(t + '-tab').style.display = 'flex';
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }

        function exitGame() {
            document.getElementById('arena-mode').style.display = 'none';
            document.getElementById('start-btn').innerText = "MATCH START";
        }

        // ADMIN GATE
        function checkAdmin() {
            adminClicks++;
            if(adminClicks >= 5) {
                const p = prompt("Admin ≈ûifr…ôsi:");
                if(p === "qaqa0202@") {
                    document.getElementById('admin-panel').style.display = 'block';
                    loadAdminUsers();
                }
                adminClicks = 0;
            }
        }

        function loadAdminUsers() {
            db.ref('users').on('value', s => {
                const div = document.getElementById('admin-users');
                div.innerHTML = '';
                s.forEach(u => {
                    div.innerHTML += `<div style="padding:10px; border-bottom:1px solid #333;">
                        ${u.val().username} (${u.key}) - ${u.val().puan} Puan
                        <button onclick="db.ref('users/${u.key}').remove()">Sƒ∞L</button>
                    </div>`;
                });
            });
        }
    </script>
</body>
</html>
