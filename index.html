<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CYBERISM | Pro Arena</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --neon-green: #39ff14; --neon-blue: #00f3ff; --neon-purple: #bc13fe;
            --dark: #05070a; --card: #111827; --sq-l: #475569; --sq-d: #1e293b;
        }

        body { 
            background-color: var(--dark); color: white; font-family: 'Segoe UI', sans-serif; 
            margin: 0; padding: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column;
        }

        /* Auth Screen */
        #auth-screen { position: fixed; inset: 0; background: var(--dark); z-index: 10000; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .auth-box { background: var(--card); padding: 30px; border-radius: 20px; border: 2px solid var(--neon-blue); text-align: center; width: 100%; max-width: 350px; box-shadow: 0 0 25px rgba(0, 243, 255, 0.3); }
        
        input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #334155; background: #000; color: white; box-sizing: border-box; font-size: 16px; outline: none; }
        .btn { background: var(--neon-blue); color: #000; padding: 14px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; transition: 0.3s; }
        .btn:active { transform: scale(0.98); }

        /* Header */
        header { padding: 10px 20px; background: #0c111d; border-bottom: 1px solid var(--neon-purple); display: flex; justify-content: space-between; align-items: center; z-index: 100; }

        /* Layouts */
        .container { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        .tab-content { display: none; flex: 1; padding: 15px; overflow-y: auto; }

        /* Arena Mode (Match Start olanda bura ke√ßir) */
        #arena-mode { 
            display: none; position: absolute; inset: 0; background: var(--dark); z-index: 500;
            flex-direction: row; padding: 10px; gap: 10px;
        }

        /* Chess Board */
        .board-wrapper { flex: 2; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .board { 
            display: grid; grid-template-columns: repeat(8, min(11vw, 60px)); 
            grid-template-rows: repeat(8, min(11vw, 60px)); 
            border: 5px solid #1e293b; border-radius: 8px; 
        }
        .sq { display: flex; align-items: center; justify-content: center; font-size: min(8vw, 40px); cursor: pointer; user-select: none; }
        .l { background: var(--sq-l); } .d { background: var(--sq-d); }
        .sel { background: rgba(57, 255, 20, 0.4) !important; }
        .w { color: white; } .b { color: black; filter: drop-shadow(0 0 1px white); }

        /* Arena Chat */
        .arena-sidebar { flex: 1; background: #0c111d; border-radius: 12px; display: flex; flex-direction: column; border: 1px solid #1e293b; max-width: 350px; }
        .arena-chat-box { flex: 1; overflow-y: auto; padding: 10px; font-size: 14px; }
        .arena-chat-input { display: flex; padding: 10px; gap: 5px; border-top: 1px solid #1e293b; }

        /* Navbar */
        nav { height: 65px; background: #0c111d; border-top: 1px solid var(--neon-blue); display: flex; justify-content: space-around; align-items: center; }
        .nav-btn { background: none; border: none; color: gray; font-size: 11px; cursor: pointer; text-align: center; }
        .nav-btn.active { color: var(--neon-blue); }

        /* Responsive */
        @media (max-width: 800px) {
            #arena-mode { flex-direction: column; overflow-y: auto; }
            .arena-sidebar { max-width: 100%; height: 250px; }
            .board { grid-template-columns: repeat(8, 11.5vw); grid-template-rows: repeat(8, 11.5vw); }
        }

        .user-row { background: #1a2233; padding: 10px; margin-bottom: 8px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-box">
            <h1 style="color: var(--neon-blue); margin:0; letter-spacing: 2px;">CYBERISM</h1>
            <p style="font-size:12px; color:gray; margin-bottom:20px;">Giri≈ü ID v…ô ya Yeni Ad yazƒ±n</p>
            <input type="text" id="user-in" placeholder="Username / ID">
            <input type="password" id="pass-in" placeholder="≈ûifr…ô">
            <button class="btn" onclick="login()">DAXƒ∞L OL</button>
            <button class="btn" style="background:var(--neon-purple); color:white; margin-top:10px;" onclick="register()">QEYDƒ∞YYAT</button>
        </div>
    </div>

    <header>
        <span id="display-name" style="font-weight:bold; color:var(--neon-blue);">Y√ºkl…ônir...</span>
        <span style="color:var(--neon-green); font-weight:bold;">PUAN: <span id="display-puan">0</span></span>
    </header>

    <div class="container">
        <div id="game-tab" class="tab-content" style="display:flex; flex-direction:column; align-items:center; justify-content:center;">
            <div style="text-align:center; margin-bottom:20px;">
                <h2 style="margin:0;">XO≈û G∆èLDƒ∞N!</h2>
                <p style="color:gray;">Hazƒ±rsansa r…ôqib axtarƒ±≈üƒ±na ba≈üla.</p>
            </div>
            <button class="btn" style="width:250px; height:60px; font-size:18px;" id="match-btn" onclick="startMatchmaking()">MATCH START</button>
        </div>

        <div id="arena-mode">
            <div class="board-wrapper">
                <div style="margin-bottom:10px; width: 100%; display:flex; justify-content:space-between;">
                    <span>R…ôqib: <b id="opp-name" style="color:red">...</b></span>
                    <button onclick="exitMatch()" style="background:none; border:none; color:gray; cursor:pointer;">Oyundan √áƒ±x</button>
                </div>
                <div id="chess-board" class="board"></div>
            </div>
            
            <div class="arena-sidebar">
                <div style="padding:10px; border-bottom:1px solid #1e293b; font-weight:bold; color:var(--neon-blue);">OYUN √áATI</div>
                <div id="arena-chat" class="arena-chat-box"></div>
                <div class="arena-chat-input">
                    <input type="text" id="arena-msg" placeholder="Mesaj..." style="margin:0; padding:8px;">
                    <button class="btn" style="width:60px; padding:5px;" onclick="sendArenaChat()">OK</button>
                </div>
            </div>
        </div>

        <div id="leader-tab" class="tab-content">
            <h2 style="color:#fbbf24;">D√ºnya Sƒ±ralamasƒ±</h2>
            <div id="leaderboard"></div>
        </div>

        <div id="friends-tab" class="tab-content">
            <h2>Dostlar</h2>
            <input type="text" id="friend-id-in" placeholder="Dost ID yaz...">
            <button class="btn" onclick="addFriend()">∆èlav…ô Et</button>
            <div id="friends-list" style="margin-top:15px;"></div>
        </div>
    </div>

    <nav id="bottom-nav">
        <div class="nav-btn active" onclick="switchTab('game', this)"><i>üéÆ</i>ARENA</div>
        <div class="nav-btn" onclick="switchTab('leader', this)"><i>üèÜ</i>TOP</div>
        <div class="nav-btn" onclick="switchTab('friends', this)"><i>üë•</i>DOSTLAR</div>
    </nav>

    <script>
        const firebaseConfig = { databaseURL: "https://cyberism-7104c-default-rtdb.firebaseio.com" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const game = new Chess();
        const boardEl = document.getElementById('chess-board');
        let myData = null;
        let selectedSq = null;

        function register() {
            const u = document.getElementById('user-in').value;
            const p = document.getElementById('pass-in').value;
            if(u.length < 3) return alert("Ad qƒ±sadƒ±r!");
            const id = "ism" + Math.floor(1000 + Math.random() * 9000);
            db.ref('users/' + id).set({ username: u, password: p, id: id, puan: 0, status: "online" })
            .then(() => {
                alert("Qeydiyyat tamamlandƒ±! Sizin ID: " + id);
                loginDirect(id, p);
            });
        }

        function login() {
            loginDirect(document.getElementById('user-in').value, document.getElementById('pass-in').value);
        }

        function loginDirect(id, p) {
            db.ref('users/' + id).once('value', s => {
                const u = s.val();
                if(u && u.password === p) {
                    myData = u;
                    document.getElementById('auth-screen').style.display = 'none';
                    document.getElementById('display-name').innerText = u.username;
                    document.getElementById('display-puan').innerText = u.puan;
                    init();
                } else alert("M…ôlumatlar s…ôhvdir!");
            });
        }

        function startMatchmaking() {
            const btn = document.getElementById('match-btn');
            btn.innerText = "AXTARILIR...";
            btn.disabled = true;

            setTimeout(() => {
                const names = ["Shadow_Azeri", "Cyber_Knight", "Alpha_Zero", "ISM_Player", "Elite_King"];
                document.getElementById('opp-name').innerText = names[Math.floor(Math.random()*names.length)];
                
                // Arena Mode aktivl…ô≈üdirilir
                document.getElementById('arena-mode').style.display = 'flex';
                document.getElementById('bottom-nav').style.display = 'none';
                game.reset();
                drawBoard();
            }, 2000);
        }

        function exitMatch() {
            if(confirm("Oyundan √ßƒ±xmaq ist…ôyirs…ôn?")) {
                document.getElementById('arena-mode').style.display = 'none';
                document.getElementById('bottom-nav').style.display = 'flex';
                document.getElementById('match-btn').innerText = "MATCH START";
                document.getElementById('match-btn').disabled = false;
            }
        }

        function drawBoard() {
            boardEl.innerHTML = '';
            const b = game.board();
            const pMap = { 'p': '‚ôü', 'r': '‚ôú', 'n': '‚ôû', 'b': '‚ôù', 'q': '‚ôõ', 'k': '‚ôö', 'P': '‚ôô', 'R': '‚ôñ', 'N': '‚ôò', 'B': '‚ôó', 'Q': '‚ôï', 'K': '‚ôî' };
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                    const s = document.createElement('div');
                    s.className = `sq ${(i + j) % 2 === 0 ? 'l' : 'd'}`;
                    const p = b[i][j];
                    if (p) {
                        s.textContent = pMap[p.color === 'w' ? p.type.toUpperCase() : p.type.toLowerCase()];
                        s.classList.add(p.color === 'w' ? 'w' : 'b');
                    }
                    s.onclick = () => handleMove(String.fromCharCode(97 + j) + (8 - i));
                    boardEl.appendChild(s);
                }
            }
        }

        function handleMove(pos) {
            if (selectedSq === pos) { selectedSq = null; drawBoard(); return; }
            if (selectedSq) {
                const move = game.move({ from: selectedSq, to: pos, promotion: 'q' });
                if (move) {
                    selectedSq = null; drawBoard();
                    if(game.in_checkmate()) { alert("TEBRƒ∞KLER!"); updatePuan(100); exitMatch(); }
                    setTimeout(botLogic, 700);
                } else { selectedSq = pos; drawBoard(); highlight(pos); }
            } else { selectedSq = pos; highlight(pos); }
        }

        function botLogic() {
            const moves = game.moves();
            if (moves.length > 0) {
                game.move(moves[Math.floor(Math.random() * moves.length)]);
                drawBoard();
                if(game.in_checkmate()) { alert("M∆èƒûLUB OLDUNUZ!"); updatePuan(-30); exitMatch(); }
            }
        }

        function updatePuan(v) {
            myData.puan = Math.max(0, myData.puan + v);
            document.getElementById('display-puan').innerText = myData.puan;
            db.ref('users/' + myData.id).update({ puan: myData.puan });
        }

        function sendArenaChat() {
            const m = document.getElementById('arena-msg').value;
            if(!m) return;
            const chat = document.getElementById('arena-chat');
            chat.innerHTML += `<div><b>S…ôn:</b> ${m}</div>`;
            document.getElementById('arena-msg').value = '';
            chat.scrollTop = chat.scrollHeight;
            
            // Bot cavab simulyasiyasƒ± (Opsional)
            setTimeout(() => {
                const replies = ["Yax≈üƒ± gedi≈ü idi!", "H…ôl…ô bitm…ôyib...", "Uƒüurlar!", "üòè"];
                chat.innerHTML += `<div style="color:red"><b>R…ôqib:</b> ${replies[Math.floor(Math.random()*replies.length)]}</div>`;
                chat.scrollTop = chat.scrollHeight;
            }, 1500);
        }

        function switchTab(t, el) {
            document.querySelectorAll('.tab-content').forEach(x => x.style.display = 'none');
            document.getElementById(t + '-tab').style.display = (t==='game'?'flex':'block');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }

        function init() {
            // Liderl…ôr
            db.ref('users').orderByChild('puan').limitToLast(10).on('value', s => {
                const lb = document.getElementById('leaderboard');
                lb.innerHTML = '';
                let a = []; s.forEach(c => a.push(c.val()));
                a.reverse().forEach((u, i) => {
                    lb.innerHTML += `<div class="user-row"><span>${i+1}. ${u.username}</span><b>${u.puan}</b></div>`;
                });
            });
        }

        function highlight(pos) {
            // Seliqeli se√ßim vizualƒ±
        }
    </script>
</body>
</html>
