<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CYBERISM | Mobile Arena</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --neon-green: #39ff14; --neon-blue: #00f3ff; --neon-purple: #bc13fe;
            --dark: #05070a; --card: #111827; --sq-l: #475569; --sq-d: #1e293b;
        }

        body { background-color: var(--dark); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; overflow: hidden; display: flex; flex-direction: column; height: 100vh; }

        /* Auth Screen */
        #auth-screen { position: fixed; inset: 0; background: var(--dark); z-index: 5000; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .auth-box { background: var(--card); padding: 25px; border-radius: 20px; border: 2px solid var(--neon-blue); text-align: center; width: 100%; max-width: 320px; box-shadow: 0 0 20px var(--neon-blue); }
        input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #334155; background: #000; color: white; box-sizing: border-box; font-size: 16px; }

        /* Navbar & Panels */
        header { padding: 10px 15px; background: #0c111d; border-bottom: 1px solid var(--neon-purple); display: flex; justify-content: space-between; align-items: center; font-size: 14px; }
        .tab-content { flex: 1; overflow-y: auto; padding: 15px; display: none; }
        #game-tab { display: flex; flex-direction: column; align-items: center; justify-content: center; }

        /* Chess Board Mobile Optimized */
        .board { display: grid; grid-template-columns: repeat(8, 11.5vw); grid-template-rows: repeat(8, 11.5vw); border: 4px solid #1e293b; border-radius: 8px; }
        .sq { width: 11.5vw; height: 11.5vw; display: flex; align-items: center; justify-content: center; font-size: 8vw; cursor: pointer; user-select: none; }
        .l { background: var(--sq-l); } .d { background: var(--sq-d); }
        .sel { background: rgba(57, 255, 20, 0.4) !important; }

        /* Bottom Menu */
        nav { height: 65px; background: #0c111d; border-top: 1px solid var(--neon-blue); display: flex; justify-content: space-around; align-items: center; padding-bottom: env(safe-area-inset-bottom); }
        .nav-btn { background: none; border: none; color: gray; font-size: 10px; text-align: center; cursor: pointer; }
        .nav-btn.active { color: var(--neon-blue); }
        .nav-btn i { font-size: 20px; display: block; margin-bottom: 2px; }

        /* Buttons & Lists */
        .btn { background: var(--neon-blue); color: #000; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; font-size: 14px; }
        .user-row { background: #1a2233; padding: 10px; margin-bottom: 8px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; }
        .online-dot { width: 8px; height: 8px; background: var(--neon-green); border-radius: 50%; display: inline-block; margin-right: 5px; box-shadow: 0 0 5px var(--neon-green); }

        #chat-box { background: #000; height: 60vh; border-radius: 10px; overflow-y: auto; padding: 10px; margin-bottom: 10px; font-size: 14px; }
        .msg { margin-bottom: 8px; line-height: 1.4; }
        .msg b { color: var(--neon-purple); }

        #admin-modal { display: none; position: fixed; inset: 0; background: var(--dark); z-index: 6000; padding: 20px; }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-box">
            <h1 style="color: var(--neon-blue); margin:0;">CYBERISM</h1>
            <p style="font-size:12px; color:gray; margin-bottom:15px;">Salam Komandir, hazƒ±rsan?</p>
            <input type="text" id="user-in" placeholder="ID (Giri≈ü √º√ß√ºn) / Ad (Qeydiyyat)">
            <input type="password" id="pass-in" placeholder="≈ûifr…ô">
            <button class="btn" onclick="login()">DAXƒ∞L OL</button>
            <button class="btn" style="background:var(--neon-purple); color:white; margin-top:10px;" onclick="register()">QEYDƒ∞YYAT</button>
            <div id="login-id-display" style="margin-top:12px; font-size:11px; color:var(--neon-green);"></div>
        </div>
    </div>

    <header>
        <span id="display-name" style="font-weight:bold; color:var(--neon-blue);">Y√ºkl…ônir...</span>
        <span style="color:var(--neon-green); font-weight:bold;">üèÜ <span id="display-puan">0</span></span>
    </header>

    <div id="game-tab" class="tab-content" style="display:flex;">
        <div id="opp-panel" style="margin-bottom:15px; font-size:16px;">
            R…ôqib: <b id="opp-name" style="color:var(--neon-purple)">Axtarƒ±lƒ±r...</b>
        </div>
        <div id="chess-board" class="board"></div>
        <button class="btn" style="width:70%; margin-top:25px;" onclick="matchmake()">MATCH STARTED</button>
    </div>

    <div id="friends-tab" class="tab-content">
        <h2 style="color:var(--neon-purple);">Dostlar</h2>
        <div style="display:flex; gap:5px; margin-bottom:15px;">
            <input type="text" id="friend-id-in" placeholder="Dost ID-si yaz..." style="margin:0;">
            <button class="btn" style="width:80px;" onclick="addFriend()">∆èlav…ô Et</button>
        </div>
        <div id="friends-list"></div>
    </div>

    <div id="leader-tab" class="tab-content">
        <h2 style="color:#fbbf24;">D√ºnya Sƒ±ralamasƒ±</h2>
        <div id="leaderboard"></div>
    </div>

    <div id="chat-tab" class="tab-content">
        <div id="chat-box"></div>
        <div style="display:flex; gap:5px;">
            <input type="text" id="chat-in" placeholder="Mesaj yaz..." style="margin:0;">
            <button class="btn" style="width:80px;" onclick="sendChat()">G√∂nd…ôr</button>
        </div>
    </div>

    <nav>
        <div class="nav-btn active" onclick="switchTab('game', this)"><i>üéÆ</i>OYUN</div>
        <div class="nav-btn" onclick="switchTab('friends', this)"><i>üë•</i>DOSTLAR</div>
        <div class="nav-btn" onclick="switchTab('leader', this)"><i>üèÜ</i>SIRALAMA</div>
        <div class="nav-btn" onclick="switchTab('chat', this)"><i>üí¨</i>√áAT</div>
    </nav>

    <div id="admin-trigger" onclick="adminGate()" style="position:fixed; top:0; right:0; width:40px; height:40px; opacity:0;"></div>
    <div id="admin-modal">
        <h2 style="color:red;">ADMIN PANEL</h2>
        <div id="admin-list"></div>
        <button class="btn" onclick="document.getElementById('admin-modal').style.display='none'">Baƒüla</button>
    </div>

    <script>
        const firebaseConfig = {
            databaseURL: "https://cyberism-7104c-default-rtdb.firebaseio.com",
            projectId: "cyberism-7104c",
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const game = new Chess();
        const boardEl = document.getElementById('chess-board');
        let myData = null;
        let selectedSq = null;
        let adminSteps = 0;

        // AUTH
        function register() {
            const u = document.getElementById('user-in').value;
            const p = document.getElementById('pass-in').value;
            if(u.length < 3) return alert("Ad √ßox qƒ±sadƒ±r!");
            const id = "ism" + Math.floor(1000 + Math.random() * 8999);
            db.ref('users/' + id).set({ username: u, password: p, id: id, puan: 0, status: "online", banned: false })
            .then(() => {
                alert("Uƒüurlu! Sizin Giri≈ü ID: " + id);
                document.getElementById('login-id-display').innerText = "Son qeydiyyat ID: " + id;
            });
        }

        function login() {
            const id = document.getElementById('user-in').value;
            const p = document.getElementById('pass-in').value;
            db.ref('users/' + id).once('value', s => {
                const u = s.val();
                if(u && u.password === p) {
                    if(u.banned) return alert("Siz BAN edilmisiniz!");
                    myData = u;
                    db.ref('users/' + id).update({ status: "online" });
                    document.getElementById('auth-screen').style.display = 'none';
                    document.getElementById('display-name').innerText = u.username;
                    document.getElementById('display-puan').innerText = u.puan;
                    init();
                } else alert("M…ôlumatlar yanlƒ±≈üdƒ±r!");
            });
        }

        function switchTab(tab, el) {
            document.querySelectorAll('.tab-content').forEach(t => t.style.display = 'none');
            document.getElementById(tab + '-tab').style.display = (tab === 'game' ? 'flex' : 'block');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }

        // CHESS
        function drawBoard() {
            boardEl.innerHTML = '';
            const b = game.board();
            const pMap = { 'p': '‚ôü', 'r': '‚ôú', 'n': '‚ôû', 'b': '‚ôù', 'q': '‚ôõ', 'k': '‚ôö', 'P': '‚ôô', 'R': '‚ôñ', 'N': '‚ôò', 'B': '‚ôó', 'Q': '‚ôï', 'K': '‚ôî' };
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                    const s = document.createElement('div');
                    s.className = `sq ${(i + j) % 2 === 0 ? 'l' : 'd'}`;
                    const p = b[i][j];
                    if (p) {
                        s.textContent = pMap[p.color === 'w' ? p.type.toUpperCase() : p.type.toLowerCase()];
                        s.classList.add(p.color === 'w' ? 'w' : 'b');
                    }
                    s.onclick = () => handleMove(String.fromCharCode(97 + j) + (8 - i));
                    boardEl.appendChild(s);
                }
            }
        }

        function handleMove(pos) {
            if (selectedSq === pos) { selectedSq = null; drawBoard(); return; }
            if (selectedSq) {
                const move = game.move({ from: selectedSq, to: pos, promotion: 'q' });
                if (move) {
                    selectedSq = null; drawBoard();
                    if(game.in_checkmate()) { alert("QALƒ∞B!"); updatePuan(100); game.reset(); }
                    setTimeout(botMove, 800);
                } else { selectedSq = pos; drawBoard(); highlight(pos); }
            } else { selectedSq = pos; highlight(pos); }
        }

        function botMove() {
            const moves = game.moves();
            if (moves.length > 0) {
                game.move(moves[Math.floor(Math.random() * moves.length)]);
                drawBoard();
                if(game.in_checkmate()) { alert("M∆èƒûLUB!"); updatePuan(-50); game.reset(); }
            }
        }

        function updatePuan(val) {
            myData.puan = Math.max(0, myData.puan + val);
            document.getElementById('display-puan').innerText = myData.puan;
            db.ref('users/' + myData.id).update({ puan: myData.puan });
        }

        // MATCHMAKING & FRIENDS
        function matchmake() {
            document.getElementById('opp-name').innerText = "Axtarƒ±lƒ±r...";
            setTimeout(() => {
                const names = ["Knight_99", "Alpha_Zero", "ISM_Killer", "Shadow_Pro", "Commander_A"];
                const name = names[Math.floor(Math.random()*names.length)];
                document.getElementById('opp-name').innerText = name + " (Level " + (Math.floor(Math.random()*10)+1) + ")";
                game.reset();
                drawBoard();
            }, 2500);
        }

        function addFriend() {
            const id = document.getElementById('friend-id-in').value;
            db.ref('users/' + id).once('value', s => {
                if(s.exists()) {
                    db.ref('users/' + myData.id + '/friends/' + id).set(s.val().username);
                    alert("Dost …ôlav…ô edildi!");
                } else alert("ID tapƒ±lmadƒ±!");
            });
        }

        function sendChat() {
            const m = document.getElementById('chat-in').value;
            if(m) {
                db.ref('chat').push({ u: myData.username, m: m });
                document.getElementById('chat-in').value = '';
            }
        }

        // SYNC
        function init() {
            drawBoard();
            // Liderl…ôr
            db.ref('users').orderByChild('puan').limitToLast(10).on('value', snap => {
                const lb = document.getElementById('leaderboard');
                lb.innerHTML = '';
                let arr = [];
                snap.forEach(c => arr.push(c.val()));
                arr.reverse().forEach((u, i) => {
                    lb.innerHTML += `<div class="user-row"><span>${i+1}. ${u.username}</span><b>${u.puan}</b></div>`;
                });
            });
            // √áat
            db.ref('chat').limitToLast(30).on('value', snap => {
                const box = document.getElementById('chat-box');
                box.innerHTML = '';
                snap.forEach(c => {
                    const data = c.val();
                    box.innerHTML += `<div class="msg"><b>${data.u}:</b> ${data.m}</div>`;
                });
                box.scrollTop = box.scrollHeight;
            });
            // Dost Siyahƒ±sƒ±
            db.ref('users/' + myData.id + '/friends').on('value', snap => {
                const list = document.getElementById('friends-list');
                list.innerHTML = '';
                snap.forEach(c => {
                    list.innerHTML += `<div class="user-row"><span>${c.val()}</span><button class="btn" style="width:60px; padding:5px;">D…ôv…ôt</button></div>`;
                });
            });
            // Admin Sync
            db.ref('users').on('value', snap => {
                const al = document.getElementById('admin-list');
                al.innerHTML = '';
                snap.forEach(c => {
                    const u = c.val();
                    if(u.id === myData.id && u.banned) location.reload();
                    const dot = u.status === 'online' ? '<span class="online-dot"></span>' : '';
                    al.innerHTML += `<div class="user-row">${dot}${u.username} <button onclick="ban('${u.id}')">BAN</button></div>`;
                });
            });
        }

        function highlight(pos) { document.querySelectorAll('.sq').forEach(s => { 
            const j = pos.charCodeAt(0) - 97;
            const i = 8 - parseInt(pos[1]);
            if(s.style.gridColumnStart == j+1) s.classList.add('sel'); 
        }); }

        function ban(id) { db.ref('users/' + id).update({ banned: true }); }
        
        function adminGate() {
            adminSteps++;
            if(adminSteps === 5) {
                if(prompt("PASS:") === "qaqa0202@") document.getElementById('admin-modal').style.display = 'block';
                adminSteps = 0;
            }
        }
    </script>
</body>
</html>
