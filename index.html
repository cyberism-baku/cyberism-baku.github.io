<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CYBERISM | Pro Arena</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --neon-green: #39ff14; --neon-blue: #00f3ff; --neon-purple: #bc13fe;
            --dark: #05070a; --card: #111827; --square-l: #475569; --square-d: #1e293b;
        }

        body { background-color: var(--dark); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* Auth Screen */
        #auth-screen { position: fixed; inset: 0; background: var(--dark); z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .auth-box { background: var(--card); padding: 30px; border-radius: 20px; border: 2px solid var(--neon-blue); text-align: center; width: 320px; box-shadow: 0 0 20px var(--neon-blue); }
        input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #334155; background: #000; color: white; box-sizing: border-box; }

        /* Side Panels */
        #side-panel { width: 280px; background: #0c111d; border-right: 1px solid var(--neon-purple); padding: 15px; display: flex; flex-direction: column; }
        #chat-panel { width: 250px; background: #0c111d; border-left: 1px solid var(--neon-blue); padding: 10px; display: flex; flex-direction: column; }

        /* Main Game Area */
        #main-stage { flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        .board { display: grid; grid-template-columns: repeat(8, 55px); grid-template-rows: repeat(8, 55px); border: 5px solid #1e293b; border-radius: 8px; }
        .sq { width: 55px; height: 55px; display: flex; align-items: center; justify-content: center; font-size: 38px; cursor: pointer; user-select: none; }
        .l { background: var(--square-l); } .d { background: var(--square-d); }
        .sel { background: rgba(57, 255, 20, 0.4) !important; }
        .w { color: #fff; filter: drop-shadow(0 0 2px #000); } .b { color: #000; filter: drop-shadow(0 0 2px #fff); }

        /* Components */
        .btn { background: var(--neon-blue); color: #000; padding: 10px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 5px; width: 100%; }
        .user-row { display: flex; justify-content: space-between; padding: 6px; background: #1a2233; margin-bottom: 4px; border-radius: 5px; font-size: 12px; align-items: center;}
        .online-dot { width: 8px; height: 8px; background: var(--neon-green); border-radius: 50%; display: inline-block; margin-right: 5px; box-shadow: 0 0 5px var(--neon-green); }
        
        #chat-box { flex: 1; overflow-y: auto; background: #000; border-radius: 5px; padding: 5px; font-size: 12px; margin-bottom: 5px; }
        .msg { margin-bottom: 5px; border-bottom: 1px solid #111; padding-bottom: 2px; }
        .msg b { color: var(--neon-purple); }

        #admin-modal { display: none; position: fixed; inset: 5%; background: var(--card); border: 2px solid red; z-index: 3000; padding: 20px; overflow-y: auto; }
        #admin-trigger { position: fixed; bottom: 5px; right: 5px; opacity: 0.1; cursor: pointer; font-size: 10px;}
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-box">
            <h1 style="color: var(--neon-blue); margin:0;">CYBERISM</h1>
            <p style="font-size:12px; color:gray;">Salam Komandir, xo≈ü g…ôldin!</p>
            <input type="text" id="user-in" placeholder="ƒ∞stifad…ô√ßi Adƒ±">
            <input type="password" id="pass-in" placeholder="≈ûifr…ô">
            <button class="btn" onclick="login()">DAXƒ∞L OL</button>
            <button class="btn" style="background:var(--neon-purple); color:white;" onclick="register()">QEYDƒ∞YYATDAN KE√á</button>
            <div id="login-id-display" style="margin-top:10px; font-size:11px; color:var(--neon-green);"></div>
        </div>
    </div>

    <div id="admin-modal">
        <h2 style="color: red;">üî• CYBER CONTROL PANEL</h2>
        <div id="admin-list"></div>
        <button class="btn" style="width:100px;" onclick="document.getElementById('admin-modal').style.display='none'">Baƒüla</button>
    </div>

    <div id="side-panel">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2 style="color: var(--neon-purple); font-size: 16px;">üë§ PROFƒ∞L</h2>
            <button onclick="logout()" style="background:red; color:white; border:none; border-radius:4px; cursor:pointer; font-size:10px; padding:3px 7px;">√áIXI≈û</button>
        </div>
        <div id="my-profile" style="background:#1a2233; padding:10px; border-radius:8px; font-size:13px; margin-bottom:15px;">
            <b id="display-name" style="color:var(--neon-blue)">...</b><br>
            <span id="display-id" style="color:gray; font-size:11px;">ID: ...</span><br>
            <span style="color:var(--neon-green)">PUAN: <span id="display-puan">0</span></span>
        </div>

        <h2 style="color: #fbbf24; font-size: 16px;">üèÜ TOP 10 Lƒ∞DER</h2>
        <div id="leaderboard" style="flex: 1; overflow-y: auto;"></div>
    </div>

    <div id="main-stage">
        <div id="opp-info" style="margin-bottom: 10px; font-size:14px;">R…ôqib: <b id="opp-name" style="color:red;">Bot (AI)</b></div>
        <div id="chess-board" class="board"></div>
        <button class="btn" style="width:200px; margin-top:20px;" onclick="matchmake()">MATCH (1v1)</button>
    </div>

    <div id="chat-panel">
        <h2 style="color: var(--neon-blue); font-size: 16px;">üí¨ GLOBAL CHAT</h2>
        <div id="chat-box"></div>
        <input type="text" id="chat-in" placeholder="Mesaj yaz..." onkeypress="if(event.key==='Enter') sendChat()">
        <button class="btn" style="font-size:11px;" onclick="sendChat()">G√ñND∆èR</button>
    </div>

    <div id="admin-trigger" onclick="adminGate()">ismayilovismayil</div>

    <script>
        const firebaseConfig = {
            databaseURL: "https://cyberism-7104c-default-rtdb.firebaseio.com",
            projectId: "cyberism-7104c",
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const game = new Chess();
        const boardEl = document.getElementById('chess-board');
        let myData = null;
        let selectedSq = null;
        let adminSteps = 0;

        // Audio
        const moveSnd = new Audio('https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3');

        // AUTH FUNCTIONS
        function register() {
            const u = document.getElementById('user-in').value;
            const p = document.getElementById('pass-in').value;
            if(u.length < 3 || p.length < 4) return alert("Ad min 3, ≈üifr…ô min 4 h…ôrf!");
            
            const id = "ism" + Math.floor(1000 + Math.random() * 9000);
            db.ref('users/' + id).set({
                username: u,
                password: p,
                id: id,
                puan: 0,
                status: "online",
                banned: false
            }).then(() => {
                alert("Qeydiyyat uƒüurlu! Sizin ID: " + id + "\nBu ID il…ô daxil olacaqsƒ±nƒ±z.");
                document.getElementById('login-id-display').innerText = "Son qeydiyyat ID: " + id;
            });
        }

        function login() {
            const idInput = document.getElementById('user-in').value; // ID il…ô girilir
            const pInput = document.getElementById('pass-in').value;

            db.ref('users/' + idInput).once('value', s => {
                const u = s.val();
                if(u && u.password === pInput) {
                    if(u.banned) return alert("T∆è∆èSS√úF! S…ôn bu arenadan √∂m√ºrl√ºk BAN edilmis…ôn!");
                    myData = u;
                    db.ref('users/' + u.id).update({ status: "online" });
                    enterArena();
                } else {
                    alert("ID v…ô ya ≈üifr…ô s…ôhvdir!");
                }
            });
        }

        function enterArena() {
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('display-name').innerText = myData.username;
            document.getElementById('display-id').innerText = "ID: " + myData.id;
            document.getElementById('display-puan').innerText = myData.puan;
            drawBoard();
            liveSync();
        }

        function logout() {
            if(myData) db.ref('users/' + myData.id).update({ status: "offline" });
            location.reload();
        }

        // CHAT
        function sendChat() {
            const txt = document.getElementById('chat-in').value;
            if(!txt || !myData) return;
            db.ref('chat').push({ user: myData.username, msg: txt });
            document.getElementById('chat-in').value = "";
        }

        // GAME LOGIC
        function drawBoard() {
            boardEl.innerHTML = '';
            const b = game.board();
            const pMap = { 'p': '‚ôü', 'r': '‚ôú', 'n': '‚ôû', 'b': '‚ôù', 'q': '‚ôõ', 'k': '‚ôö', 'P': '‚ôô', 'R': '‚ôñ', 'N': '‚ôò', 'B': '‚ôó', 'Q': '‚ôï', 'K': '‚ôî' };
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                    const s = document.createElement('div');
                    s.className = `sq ${(i + j) % 2 === 0 ? 'l' : 'd'}`;
                    s.dataset.pos = String.fromCharCode(97 + j) + (8 - i);
                    const p = b[i][j];
                    if (p) {
                        s.textContent = pMap[p.color === 'w' ? p.type.toUpperCase() : p.type.toLowerCase()];
                        s.classList.add(p.color === 'w' ? 'w' : 'b');
                    }
                    s.onclick = () => handleMove(s.dataset.pos);
                    boardEl.appendChild(s);
                }
            }
        }

        function handleMove(pos) {
            if (selectedSq === pos) { selectedSq = null; drawBoard(); return; }
            if (selectedSq) {
                const move = game.move({ from: selectedSq, to: pos, promotion: 'q' });
                if (move) {
                    moveSnd.play();
                    selectedSq = null;
                    drawBoard();
                    if(game.in_checkmate()) { alert("QALƒ∞B G∆èLDƒ∞N!"); updatePuan(100); game.reset(); drawBoard(); }
                    setTimeout(botMove, 800);
                } else { selectedSq = pos; drawBoard(); highlight(pos); }
            } else { selectedSq = pos; highlight(pos); }
        }

        function botMove() {
            const moves = game.moves();
            if (moves.length > 0) {
                game.move(moves[Math.floor(Math.random() * moves.length)]);
                moveSnd.play();
                drawBoard();
                if(game.in_checkmate()) { alert("M∆èƒûLUB OLDUN!"); updatePuan(-50); game.reset(); drawBoard(); }
            }
        }

        function updatePuan(val) {
            myData.puan += val;
            if(myData.puan < 0) myData.puan = 0;
            document.getElementById('display-puan').innerText = myData.puan;
            db.ref('users/' + myData.id).update({ puan: myData.puan });
        }

        // SYNC
        function liveSync() {
            // Leaderboard (Top 10)
            db.ref('users').orderByChild('puan').limitToLast(10).on('value', snap => {
                const lb = document.getElementById('leaderboard');
                lb.innerHTML = '';
                let list = [];
                snap.forEach(c => list.push(c.val()));
                list.reverse().forEach((u, i) => {
                    lb.innerHTML += `<div class="user-row"><span>${i+1}. ${u.username}</span><b>${u.puan}</b></div>`;
                });
            });

            // Chat Sync
            db.ref('chat').limitToLast(20).on('value', snap => {
                const cb = document.getElementById('chat-box');
                cb.innerHTML = '';
                snap.forEach(c => {
                    const m = c.val();
                    cb.innerHTML += `<div class="msg"><b>${m.user}:</b> ${m.msg}</div>`;
                });
                cb.scrollTop = cb.scrollHeight;
            });

            // Admin List & Online Check
            db.ref('users').on('value', snap => {
                const al = document.getElementById('admin-list');
                al.innerHTML = '';
                snap.forEach(c => {
                    const u = c.val();
                    const status = u.status === 'online' ? '<span class="online-dot"></span>' : '';
                    al.innerHTML += `<div class="user-row">${status} ${u.username} (${u.id}) 
                    <button onclick="ban('${u.id}')" style="background:red; color:white; border:none; cursor:pointer;">BAN</button></div>`;
                    
                    // Ban check for current user
                    if(myData && u.id === myData.id && u.banned) { alert("BAN EDƒ∞LDƒ∞Nƒ∞Z!"); logout(); }
                });
            });
        }

        function highlight(pos) { document.querySelectorAll('.sq').forEach(s => { if(s.dataset.pos === pos) s.classList.add('sel'); }); }
        function matchmake() { 
            const opps = ["Commander_X", "Cyber_King", "Alpha_Zero", "ISM_Killer"];
            document.getElementById('opp-name').innerText = opps[Math.floor(Math.random()*opps.length)];
            alert("R…ôqib tapƒ±ldƒ±! Oyun ba≈ülayƒ±r.");
        }

        function ban(id) {
            if(confirm(id + " ID-li oyun√ßunu arenadan qovmaq ist…ôyirs…ôn?")) {
                db.ref('users/' + id).update({ banned: true, status: "offline" });
            }
        }

        function adminGate() {
            adminSteps++;
            if(adminSteps === 5) {
                const p = prompt("ADMIN PASS:");
                if(p === "qaqa0202@") document.getElementById('admin-modal').style.display = 'block';
                adminSteps = 0;
            }
        }
    </script>
</body>
</html>
